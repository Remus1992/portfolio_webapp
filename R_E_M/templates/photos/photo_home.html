{% extends 'base.html' %}

{% load static %}

{% block title %}
    : Photo Home
{% endblock %}

{% block content %}

    <head>
        <link rel="stylesheet" type="text/css" href="{% static 'styles/style.css' %}"/>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    </head>
    <style>

        body {
            font-family: 'Alegreya Sans SC', sans-serif;

        }


    </style>
    <div class="page_container">
        <div class="search_container">
            <form method="GET" action="">
                <input type="text" name="q" placeholder="Search.." id="search_bar">
                <button type="submit" value="Search"><img src="/static/R_E_M/img/search_icon.png" alt="search_logo"
                                                          id="search_img"/>
                </button>
            </form>

        </div>
        <div class="categories-link-set">
            {% for c in album_cats %}
                <span class="checkbox" id="{{ c.slug }}">
                    <input class="filter-checkbox" type="checkbox">
                    <label for="{{ c.name }}">{{ c.name }}</label>
                </span>
            {% endfor %}

        </div>
        <div class="line_container">
            <hr>
        </div>
        <div class="ajax_div">

        </div>
        <div class="container">

            {% if user.is_authenticated %}

                <a href="{% url 'picture_upload' %}">Upload Album</a>
                <br>
                <br>
            {% endif %}
            <div class="album_container" id="album_container">
                {% for album in albums %}
                    <a href="{% url 'album_view' album.category.slug album.slug %}" class="text {{ album.category.slug }}">
                        <div class="album_set">
                            <img src="{{ album.photo_album.all.0.image.url }}" class="album-image"
                                 alt="{{ album.photo_album.all.0.image }}">
                            <div class="middle">
                                <div class="text text_top">{{ album.title }}</div>
                                <div class="text text_center">
                                    <hr>
                                </div>
                                <div class="text text_bottom">{{ album.album_details }}</div>
                            </div>
                        </div>
                    </a>
                {% endfor %}
            </div>
            <!--
            {% for cat in album_cats %}
                <div class="category_container">
                    <h1>-------- {{ cat.name }} --------</h1>
                </div>
                <div class="album_container">
                    {% for album in albums %}
                        {% if album.category == cat %}
                            <a href="{% url 'album_view' album.category.slug album.slug %}" class="text">
                                <div class="album_set">
                                    <img src="{{ album.photo_album.all.0.image.url }}" class="image"
                                         alt="{{ album.photo_album.all.0.alt }}">
                                    <div class="middle">
                                        <div class="text text_top">{{ album.title }}</div>
                                        <div class="text text_center">
                                            <hr>
                                        </div>
                                        <div class="text text_bottom">{{ album.album_details }}</div>
                                    </div>
                                </div>
                            </a>
                        {% endif %}
                    {% endfor %}
                </div>
            {% endfor %}
-->
        </div>
    </div>

    <script>
        $(document).ready(function () {
            calcImgs()
        });

        function calcImgs() {
            $('img.album-image').each(function () {
                let h = $(this).height();
                let w = $(this).width();

                // console.log(h);
                // console.log(w);

                if ($(this).parent('.album-image-wrap').length === 0) {
                    // wrap the image in a "cropping" div
                    $(this).wrap('<div class="album-image-wrap"></div>');
                }

                if (h > w) {
                    // pic is portrait
                    $(this).addClass('portrait');
                    let m = -(((h / w) * 100) - 100) / 2; //math the negative margin
                    $(this).css('margin-top', m + '%');
                } else if (w > h) {
                    // pic is landscape
                    $(this).addClass('landscape');
                    let m = -(((w / h) * 100) - 100) / 2;  //math the negative margin
                    $(this).css('margin-left', m + '%');
                } else {
                    // pic is square
                    $(this).addClass('square');
                }
            })
        }

        $('.checkbox').click(function () {
            let cat = this.id;

            // removing shade from other elements
            $('.checkbox').each(function (i, el) {
                $(el).removeClass('checkFocus');
            });

            $(this).addClass('checkFocus');
        });


        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                let cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    let cookie = jQuery.trim(cookies[i]);
                    // Does this cookie string begin with the name we want?
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        let csrftoken = getCookie('csrftoken');

        function csrfSafeMethod(method) {
            // these HTTP methods do not require CSRF protection
            return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
        }

        $.ajaxSetup({
            beforeSend: function (xhr, settings) {
                if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                    xhr.setRequestHeader("X-CSRFToken", csrftoken);
                }
            }
        });

        $(".checkbox").click(function () {
            let cat = this.id;
            // console.log(category);
            $.ajax({
                url: "{% url "photo_ajax" %}",
                method: "POST",
                data: {
                    category: cat
                },
                success: function (response) {
                    //console.dir(response);
                    let ac = $("#album_container");
                    let html = "";
                    $(ac).html('');
                    $(response).each(function (i, album) {
                        html += `<a href="/photography/galleries/${album.category.slug}/${album.slug}" class="text ${album.category.slug}"><div class="album_set">
                                    <img src="${album.photo_album[0].url}" class="album-image" alt="">
                                    <div class="middle">
                                        <div class="text text_top">${album.title}</div>
                                        <div class="text text_center">
                                            <hr>
                                        </div>
                                        <div class="text text_bottom">${album.album_details}</div>
                                    </div>
                                </div>
                            </a>`
                    });
                    $(ac).html(html);
                    calcImgs();
                }
            });
        })
    </script>
{% endblock %}


{% block footer %}
    {% include 'footer_base.html' %}
{% endblock %}